// This is your Prisma schema file
// Learn more about Prisma: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// ENUMS
// ========================================

enum UserRole {
  STUDENT
  INTERVIEWER
  ADMIN
}

enum InterviewerStatus {
  PENDING
  APPROVED
  REJECTED
}

enum SessionType {
  GUIDANCE
  INTERVIEW
}

enum SessionStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum DifficultyLevel {
  EASY
  MEDIUM
  HARD
}

enum InterviewType {
  TECHNICAL
  HR
  MIXED
}

enum HiringRecommendation {
  STRONG_HIRE
  HIRE
  WEAK_HIRE
  NO_HIRE
}

// ========================================
// MODELS
// ========================================

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         UserRole
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  studentProfile     StudentProfile?
  interviewerProfile InterviewerProfile?

  @@map("users")
}

model StudentProfile {
  id              Int      @id @default(autoincrement())
  userId          Int      @unique @map("user_id")
  name            String
  college         String?
  branch          String?
  graduationYear  Int?     @map("graduation_year")
  targetRole      String?  @map("target_role")
  experienceLevel String?  @map("experience_level")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessions Session[]

  @@map("student_profiles")
}

model InterviewerProfile {
  id                  Int                @id @default(autoincrement())
  userId              Int                @unique @map("user_id")
  name                String
  education           String?
  companies           String[]
  yearsOfExperience   Int?               @map("years_of_experience")
  rolesSupported      String[]           @map("roles_supported")
  difficultyLevels    DifficultyLevel[]  @map("difficulty_levels")
  sessionTypesOffered SessionType[]      @map("session_types_offered")
  linkedinUrl         String?            @map("linkedin_url")
  status              InterviewerStatus  @default(PENDING)
  createdAt           DateTime           @default(now()) @map("created_at")
  updatedAt           DateTime           @updatedAt @map("updated_at")

  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  availabilitySlots AvailabilitySlot[]
  sessions          Session[]
  feedback          Feedback[]

  @@map("interviewer_profiles")
}

model AvailabilitySlot {
  id            Int      @id @default(autoincrement())
  interviewerId Int      @map("interviewer_id")
  startTime     DateTime @map("start_time")
  endTime       DateTime @map("end_time")
  isBooked      Boolean  @default(false) @map("is_booked")
  createdAt     DateTime @default(now()) @map("created_at")

  interviewer InterviewerProfile @relation(fields: [interviewerId], references: [id], onDelete: Cascade)

  @@map("availability_slots")
}

model Session {
  id              Int             @id @default(autoincrement())
  studentId       Int             @map("student_id")
  interviewerId   Int             @map("interviewer_id")
  sessionType     SessionType     @map("session_type")
  status          SessionStatus   @default(SCHEDULED)
  scheduledTime   DateTime        @map("scheduled_time")
  durationMinutes Int             @map("duration_minutes")
  topic           String?
  role            String?
  difficulty      DifficultyLevel?
  interviewType   InterviewType?  @map("interview_type")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")

  student     StudentProfile     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  interviewer InterviewerProfile @relation(fields: [interviewerId], references: [id], onDelete: Cascade)
  feedback    Feedback?

  @@map("sessions")
}

model Feedback {
  id                   Int                   @id @default(autoincrement())
  sessionId            Int                   @unique @map("session_id")
  interviewerId        Int                   @map("interviewer_id")
  summary              String?
  strengths            String?
  recommendations      String?
  actionItems          String?               @map("action_items")
  technicalDepth       Int?                  @map("technical_depth")
  problemSolving       Int?                  @map("problem_solving")
  communication        Int?
  confidence           Int?
  overallComments      String?               @map("overall_comments")
  hiringRecommendation HiringRecommendation? @map("hiring_recommendation")
  createdAt            DateTime              @default(now()) @map("created_at")

  session     Session            @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  interviewer InterviewerProfile @relation(fields: [interviewerId], references: [id], onDelete: Cascade)

  @@map("feedback")
}